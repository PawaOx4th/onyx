# =============================================================================
# ONYX DOCKER COMPOSE - NGINX PROXY MANAGER OVERRIDE
# =============================================================================
# Use this file when running behind Nginx Proxy Manager
# Run with: docker compose -f docker-compose.yml -f docker-compose.npm.yml up -d
# =============================================================================

services:
  # Disable the built-in nginx service
  nginx:
    profiles:
      - disabled

  # Expose web_server for Nginx Proxy Manager to connect
  web_server:
    expose:
      - "3000"
    # Optional: Use ports if NPM is on different docker network or not using Docker
    # Change the left port (host) to avoid conflicts with existing services
    # ports:
    #   - "127.0.0.1:3001:3000"  # Use port 3001 on host â†’ 3000 in container
    networks:
      - default
      - npm_network # Connect to NPM's network
    environment:
      - INTERNAL_URL=${INTERNAL_URL:-http://api_server:8080}

  # Ensure api_server is accessible for internal requests
  api_server:
    networks:
      - default
      - npm_network # Optional: if you need direct API access

networks:
  default:
    name: onyx_network
  npm_network:
    external: true
    name: ${NPM_NETWORK:-npm_default} # Change this to your NPM network name
